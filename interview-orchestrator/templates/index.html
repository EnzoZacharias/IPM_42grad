{% extends "base.html" %}

{% block content %}
<div class="interview-container">
    <!-- Linke Sidebar - Kompakt -->
    <div class="sidebar-left">
        <!-- Status Card - Kompakt -->
        <div class="card card-status">
            <div class="card-header" onclick="toggleCard(this)">
                <h3>ğŸ“Š Status</h3>
                <span class="card-toggle">â–¼</span>
            </div>
            <div class="card-body">
                <div class="status-grid-compact">
                    <div class="status-row">
                        <span class="status-label">Phase</span>
                        <span class="status-value" id="status-phase">Laden...</span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">Rolle</span>
                        <span class="status-value" id="status-role">-</span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">Fragen</span>
                        <span class="status-value" id="status-questions">0</span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">Dateien</span>
                        <span class="status-value" id="status-files">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Fortschritt Card -->
        <div class="card card-progress">
            <div class="card-header" onclick="toggleCard(this)">
                <h3>ğŸ“ˆ Fortschritt</h3>
                <span class="card-toggle">â–¼</span>
            </div>
            <div class="card-body" id="progress-section">
                <div class="progress-compact">
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progress-bar" style="width: 0%"></div>
                    </div>
                    <div class="progress-stats">
                        <span id="progress-text" class="progress-percent">0%</span>
                        <span id="progress-detail" class="progress-fields">0/0</span>
                    </div>
                </div>
                
                <!-- Themenfelder - Kompakt -->
                <div class="themes-progress" id="themes-progress" style="display: none;">
                    <ul id="themes-list" class="themes-list-compact"></ul>
                </div>
            </div>
        </div>

        <!-- Abgeschlossene Interviews -->
        <div class="card card-interviews collapsed" id="completed-interviews-section" style="display: none;">
            <div class="card-header" onclick="toggleCard(this)">
                <h3>ğŸ“‹ Interviews</h3>
                <span class="card-toggle">â–¶</span>
            </div>
            <div class="card-body" style="display: none;">
                <ul id="completed-interviews-list" class="completed-list-compact"></ul>
                <button id="new-role-btn" class="btn btn-sm btn-success">+ Neue Rolle</button>
            </div>
        </div>

        <!-- Dokument-Upload - In Sidebar verschoben -->
        <div class="card card-upload collapsed">
            <div class="card-header" onclick="toggleCard(this)">
                <h3>ğŸ“ Dokumente</h3>
                <span class="card-toggle">â–¶</span>
            </div>
            <div class="card-body" style="display: none;">
                <div class="upload-area-compact" id="upload-area">
                    <input type="file" id="file-input" multiple hidden>
                    <button id="select-files-btn" class="btn btn-sm btn-secondary">ğŸ“ Dateien wÃ¤hlen</button>
                </div>
                <div class="files-section" id="uploaded-files">
                    <ul id="files-list" class="files-list-compact"></ul>
                </div>
            </div>
        </div>

        <!-- LLM Backend - Minimiert -->
        <div class="card card-backend collapsed">
            <div class="card-header" onclick="toggleCard(this)">
                <h3>âš™ï¸ LLM</h3>
                <span class="card-toggle">â–¶</span>
            </div>
            <div class="card-body" style="display: none;">
                <div class="backend-options">
                    <label class="backend-option-compact">
                        <input type="radio" name="llm-backend" value="local" checked>
                        <span>Lokal</span>
                        <span class="backend-status" id="local-status">â³</span>
                    </label>
                    <label class="backend-option-compact">
                        <input type="radio" name="llm-backend" value="mistral_api">
                        <span>API</span>
                        <span class="backend-status" id="api-status">â³</span>
                    </label>
                </div>
                <small class="model-info">Modell: <span id="current-model">-</span></small>
            </div>
        </div>

        <!-- Aktionen -->
        <div class="action-buttons-compact">
            <button id="export-pdf-btn" class="btn btn-export-compact" title="PDF herunterladen">
                ğŸ“„ PDF
            </button>
            <button id="reset-btn" class="btn btn-reset-compact" title="Neu starten">
                ğŸ”„ Reset
            </button>
        </div>

        <!-- Prozess-AktivitÃ¤t -->
        <div class="process-activity-compact" id="process-activity" style="display: none;">
            <div class="process-indicator">
                <div class="process-spinner-small"></div>
                <span id="process-message">Verarbeite...</span>
            </div>
        </div>
    </div>

    <!-- Haupt-Chat-Bereich - Breiter -->
    <div class="chat-section">
        <div class="chat-messages" id="chat-messages">
            <div class="welcome-message">
                <h3>ğŸ‘‹ Willkommen!</h3>
                <p>Ich helfe Ihnen dabei, Ihre GeschÃ¤ftsprozesse zu dokumentieren.</p>
                <p>Bitte beantworten Sie die folgenden Fragen so detailliert wie mÃ¶glich.</p>
            </div>
        </div>
        
        <!-- Rollen-Auswahl fÃ¼r neues Interview -->
        <div class="role-selection" id="role-selection" style="display: none;">
            <h3>ğŸ¯ Interview-Modus wÃ¤hlen</h3>
            <p>WÃ¤hlen Sie die Rolle der zu befragenden Person:</p>
            <div class="role-buttons">
                <button class="role-btn" data-role="auto">
                    <span class="role-icon">ğŸ”„</span>
                    <span class="role-name">Automatisch</span>
                </button>
                <button class="role-btn" data-role="fach">
                    <span class="role-icon">ğŸ‘·</span>
                    <span class="role-name">Fachabteilung</span>
                </button>
                <button class="role-btn" data-role="it">
                    <span class="role-icon">ğŸ’»</span>
                    <span class="role-name">IT</span>
                </button>
                <button class="role-btn" data-role="management">
                    <span class="role-icon">ğŸ“Š</span>
                    <span class="role-name">Management</span>
                </button>
            </div>
        </div>
        
        <div class="chat-input-container">
            <div id="current-question" class="current-question"></div>
            <div class="input-group">
                <input type="text" 
                       id="answer-input" 
                       class="answer-input" 
                       placeholder="Ihre Antwort hier eingeben..."
                       autocomplete="off">
                <button id="send-btn" class="btn btn-primary">Senden</button>
            </div>
        </div>
    </div>
</div>

<script>
function toggleCard(header) {
    const card = header.parentElement;
    const body = card.querySelector('.card-body');
    const toggle = header.querySelector('.card-toggle');
    
    if (body.style.display === 'none') {
        body.style.display = 'block';
        toggle.textContent = 'â–¼';
        card.classList.remove('collapsed');
    } else {
        body.style.display = 'none';
        toggle.textContent = 'â–¶';
        card.classList.add('collapsed');
    }
}
</script>
{% endblock %}
